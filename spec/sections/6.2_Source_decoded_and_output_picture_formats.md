**6.2** **Source, decoded, and output picture formats**


This clause specifies the relationship between source and decoded frames and fields that is given via the bitstream.


The video source that is represented by the bitstream is a sequence of either or both frames or fields (called collectively
pictures) in decoding order.


The source and decoded pictures (frames or fields) are each comprised of one or more sample arrays:

      - Luma (Y) only (monochrome), with or without an auxiliary array.

      - Luma and two Chroma (YCbCr or YCgCo), with or without an auxiliary array.

      - Green, Blue and Red (GBR, also known as RGB), with or without an auxiliary array.

      - Arrays representing other unspecified monochrome or tri-stimulus colour samplings (for example, YZX,
also known as XYZ), with or without an auxiliary array.


For convenience of notation and terminology in this Specification, the variables and terms associated with these arrays are
referred to as luma (or L or Y) and chroma, where the two chroma arrays are referred to as Cb and Cr; regardless of the
actual colour representation method in use. The actual colour representation method in use can be indicated in syntax that
is specified in Annex E. The (monochrome) auxiliary arrays, which may or may not be present as auxiliary pictures in a
coded video sequence, are optional for decoding and can be used for such purposes as alpha blending.


The variables SubWidthC, and SubHeightC are specified in Table 6-1, depending on the chroma format sampling structure,
which is specified through chroma_format_idc and separate_colour_plane_flag. An entry marked as "-" in Table 6-1
denotes an undefined value for SubWidthC or SubHeightC. Other values of chroma_format_idc, SubWidthC, and
SubHeightC may be specified in the future by ITU-T | ISO/IEC.


**Table 6-1 – SubWidthC, and SubHeightC values derived from**

**chroma_format_idc and separate_colour_plane_flag**

|chroma_format_idc|separate_colour_plane_flag|Chroma Format|SubWidthC|SubHeightC|
|---|---|---|---|---|
|0|0|monochrome|-|-|
|1|0|4:2:0|2|2|
|2|0|4:2:2|2|1|
|3|0|4:4:4|1|1|
|3|1|4:4:4|-|-|



In monochrome sampling there is only one sample array, which is nominally considered the luma array.


In 4:2:0 sampling, each of the two chroma arrays has half the height and half the width of the luma array.


In 4:2:2 sampling, each of the two chroma arrays has the same height and half the width of the luma array.


In 4:4:4 sampling, depending on the value of separate_colour_plane_flag, the following applies:

- If separate_colour_plane_flag is equal to 0, each of the two chroma arrays has the same height and width as the luma
array.

- Otherwise (separate_colour_plane_flag is equal to 1), the three colour planes are separately processed as monochrome
sampled pictures.


The width and height of the luma sample arrays are each an integer multiple of 16. In coded video sequences using 4:2:0
chroma sampling, the width and height of chroma sample arrays are each an integer multiple of 8. In coded video sequences
using 4:2:2 sampling, the width of the chroma sample arrays is an integer multiple of 8 and the height is an integer multiple
of 16. The height of a luma array that is coded as two separate fields or in macroblock-adaptive frame-field coding (see
below) is an integer multiple of 32. In coded video sequences using 4:2:0 chroma sampling, the height of each chroma
array that is coded as two separate fields or in macroblock-adaptive frame-field coding (see below) is an integer multiple
of 16. The width or height of pictures output from the decoding process need not be an integer multiple of 16 and can be
specified using a cropping rectangle.





The syntax for the luma and (when present) chroma arrays are ordered such when data for all three colour components is
present, the data for the luma array is first, followed by any data for the Cb array, followed by any data for the Cr array,
unless otherwise specified.


The width of fields coded referring to a specific sequence parameter set is the same as that of frames coded referring to the
same sequence parameter set (see below). The height of fields coded referring to a specific sequence parameter set is half
that of frames coded referring to the same sequence parameter set (see below).


The number of bits necessary for the representation of each of the samples in the luma and chroma arrays in a video
sequence is in the range of 8 to 14, and the number of bits used in the luma array may differ from the number of bits used
in the chroma arrays.


When the value of chroma_format_idc is equal to 1, the nominal vertical and horizontal relative locations of luma and
chroma samples in frames are shown in Figure 6-1. Alternative chroma sample relative locations may be indicated in video
usability information (see Annex E).


Frame


Location of luma sample
Location of chroma sample H.264(09)_F6-1


**Figure 6-1 – Nominal vertical and horizontal locations of 4:2:0 luma and chroma samples in a frame**


A frame consists of two fields as described below. A coded picture may represent a coded frame or an individual coded
field. A coded video sequence conforming to this Recommendation | International Standard may contain arbitrary
combinations of coded frames and coded fields. The decoding process is also specified in a manner that allows smaller
regions of a coded frame to be coded either as a frame or field region, by use of macroblock-adaptive frame-field coding.


Source and decoded fields are one of two types: top field or bottom field. When two fields are output at the same time, or
are combined to be used as a reference frame (see below), the two fields (which shall be of opposite parity) are interleaved.
The first (i.e., top), third, fifth, etc., rows of a decoded frame are the top field rows. The second, fourth, sixth, etc., rows of
a decoded frame are the bottom field rows. A top field consists of only the top field rows of a decoded frame. When the
top field or bottom field of a decoded frame is used as a reference field (see below) only the even rows (for a top field) or
the odd rows (for a bottom field) of the decoded frame are used.


When the value of chroma_format_idc is equal to 1, the nominal vertical and horizontal relative locations of luma and
chroma samples in top and bottom fields are shown in Figure 6-2. The nominal vertical sampling relative locations of the
chroma samples in a top field are specified as shifted up by one-quarter luma sample height relative to the field-sampling
grid. The vertical sampling locations of the chroma samples in a bottom field are specified as shifted down by one-quarter
luma sample height relative to the field-sampling grid. Alternative chroma sample relative locations may be indicated in
the video usability information (see Annex E).

NOTE – The shifting of the chroma samples is in order for these samples to align vertically to the usual location relative to the fullframe sampling grid as shown in Figure 6-1.





Top
field



Bottom
field



Location of luma sample
Location of chroma sample



H.264(09)_F6-2



**Figure 6-2 – Nominal vertical and horizontal sampling locations of 4:2:0 samples in top and bottom fields**


When the value of chroma_format_idc is equal to 2, the chroma samples are co-sited with the corresponding luma samples
and the nominal locations in a frame and in fields are as shown in Figures 6-3 and 6-4, respectively.


Frame


H.264(09)_F6-3


Location of luma sample
Location of chroma sample


**Figure 6-** 3 **– Nominal vertical and horizontal locations of 4:2:2 luma and chroma samples in a frame**





Top
field



Bottom
field



Location of luma sample
Location of chroma sample H.264(09)_F6-4


**Figure 6-4 – Nominal vertical and horizontal sampling locations of 4:2:2 samples top and bottom fields**


When the value of chroma_format_idc is equal to 3, all array samples are co-sited for all cases of frames and fields and
the nominal locations in a frame and in fields are as shown in Figures 6-5 and 6-6, respectively.


Frame


H.264(09)_F6-5


Location of luma sample
Location of chroma sample


**Figure 6-5 – Nominal vertical and horizontal locations of 4:4:4 luma and chroma samples in a frame**



Top
field



Bottom
field



Location of luma sample
Location of chroma sample H.264(09)_F6-6


**Figure 6-6 – Nominal vertical and horizontal sampling locations of 4:4:4 samples top and bottom fields**





The samples are processed in units of macroblocks. The luma array for each macroblock is 16 samples in both width and
height. The variables MbWidthC and MbHeightC, which specify the width and height, respectively, of the chroma arrays
for each macroblock, are derived as follows:

- If chroma_format_idc is equal to 0 (monochrome) or separate_colour_plane_flag is equal to 1, MbWidthC and
MbHeightC are both equal to 0.

- Otherwise, MbWidthC and MbHeightC are derived as


MbWidthC = 16 / SubWidthC (6-1)
MbHeightC = 16 / SubHeightC (6-2)
