**7.3** **Syntax in tabular form**


**7.3.1** **NAL unit syntax**

|nal_unit( NumBytesInNALunit ) {|C|Descriptor|
|---|---|---|
|<br>**forbidden_zero_bit**|All|f(1)|
|<br>**nal_ref_idc**|All|u(2)|
|<br>**nal_unit_type**|All|u(5)|
|<br>NumBytesInRBSP = 0|||
|<br>nalUnitHeaderBytes = 1|||
|<br>if( nal_unit_type = = 14 | | nal_unit_type = = 20 | |<br> <br> <br>nal_unit_type = = 21 ) {|||
|<br> <br>if( nal_unit_type ! = 21 )|||
|<br> <br> <br>**svc_extension_flag**|All|u(1)|
|<br> <br>else|||
|<br> <br> <br>**avc_3d_extension_flag**|All|u(1)|
|<br> <br>if( svc_extension_flag ) {|||
|<br> <br> <br>nal_unit_header_svc_extension( ) /* specified in Annex G */|All||
|<br> <br> <br>nalUnitHeaderBytes += 3|||
|<br> <br>} else if( avc_3d_extension_flag ) {|||
|<br> <br> <br>nal_unit_header_3davc_extension( ) /* specified in Annex J */|||
|<br> <br> <br>nalUnitHeaderBytes += 2|||
|<br> <br>} else {|||
|<br> <br> <br>nal_unit_header_mvc_extension( ) /* specified in Annex H */|All||
|<br> <br> <br>nalUnitHeaderBytes += 3|||
|<br> <br>}|||
|<br>}|||
|<br>for( i = nalUnitHeaderBytes; i < NumBytesInNALunit; i++ ) {|||
|<br> <br>if( i + 2 < NumBytesInNALunit && next_bits( 24 ) = = 0x000003 ) {|||
|<br> <br> <br>**rbsp_byte[** NumBytesInRBSP++**]**|All|b(8)|
|<br> <br> <br>**rbsp_byte[** NumBytesInRBSP++**]**|All|b(8)|
|<br> <br> <br>i += 2|||
|<br> <br> <br>**emulation_prevention_three_byte** /* equal to 0x03 */|All|f(8)|
|<br> <br>} else|||
|<br> <br> <br>**rbsp_byte[** NumBytesInRBSP++**]**|All|b(8)|
|<br>}|||
|}|||



**7.3.2** **Raw byte sequence payloads and RBSP trailing bits syntax**


**7.3.2.1** **Sequence parameter set RBSP syntax**

|seq_parameter_set_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>seq_parameter_set_data( )|0||
|<br>rbsp_trailing_bits( )|0||
|}|||






**7.3.2.1.1** **Sequence parameter set data syntax**



|seq_parameter_set_data( ) {|C|Descriptor|
|---|---|---|
|<br>**profile_idc**|0|u(8)|
|<br>**constraint_set0_flag**|0|u(1)|
|<br>**constraint_set1_flag**|0|u(1)|
|<br>**constraint_set2_flag**|0|u(1)|
|<br>**constraint_set3_flag**|0|u(1)|
|<br>**constraint_set4_flag**|0|u(1)|
|<br>**constraint_set5_flag**|0|u(1)|
|<br>**reserved_zero_2bits**/* equal to 0 ***/ **|0|u(2)|
|<br>**level_idc**<br>|0|u(8)|
|<br>**seq_parameter_set_id**|0|ue(v)|
|<br>if( profile_idc = = 100 | | profile_idc = = 110 | |<br> <br> <br>profile_idc = = 122 | | profile_idc = = 244 | | profile_idc = = 44 | |<br> <br> <br>profile_idc = = 83 | | profile_idc = = 86 | | profile_idc = = 118 | |<br> <br> <br>profile_idc = = 128 | | profile_idc = = 138 | | profile_idc = = 139 | |<br> <br> <br>profile_idc = = 134 | | profile_idc = = 135 ) {|||
|<br> <br>**chroma_format_idc**|0|ue(v)|
|<br> <br>if( chroma_format_idc = = 3 )|||
|<br> <br> <br>**separate_colour_plane_flag**|0|u(1)|
|<br> <br>**bit_depth_luma_minus8**|0|ue(v)|
|<br> <br>**bit_depth_chroma_minus8**|0|ue(v)|
|<br> <br>**qpprime_y_zero_transform_bypass_flag**|0|u(1)|
|<br> <br>**seq_scaling_matrix_present_flag**|0|u(1)|
|<br> <br>if( seq_scaling_matrix_present_flag )|||
|<br> <br> <br>for( i = 0; i < ( ( chroma_format_idc != 3 ) ? 8 : 12 ); i++ ) {|||
|<br> <br> <br> <br>**seq_scaling_list_present_flag[** i**] **|0|u(1)|
|<br> <br> <br> <br>if( seq_scaling_list_present_flag[ i ] )|||
|<br> <br> <br> <br> <br>if( i < 6 )|||
|<br> <br> <br> <br> <br> <br>scaling_list( ScalingList4x4[ i ], 16,<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>  UseDefaultScalingMatrix4x4Flag[ i ] )|0||
|<br> <br> <br> <br> <br>else|||
|<br> <br> <br> <br> <br> <br>scaling_list( ScalingList8x8[ i − 6 ], 64,<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>  UseDefaultScalingMatrix8x8Flag[ i − 6 ] )|0||
|<br> <br> <br>}|||
|<br>}|||







|log2_max_frame_num_minus4|0|ue(v)|
|---|---|---|
|<br>**pic_order_cnt_type**|0|ue(v)|
|<br>if( pic_order_cnt_type = = 0 )|||
|<br> <br>**log2_max_pic_order_cnt_lsb_minus4**|0|ue(v)|
|<br>else if( pic_order_cnt_type = = 1 ) {|||
|<br> <br>**delta_pic_order_always_zero_flag**|0|u(1)|
|<br> <br>**offset_for_non_ref_pic**|0|se(v)|
|<br> <br>**offset_for_top_to_bottom_field**|0|se(v)|
|<br> <br>**num_ref_frames_in_pic_order_cnt_cycle**|0|ue(v)|
|<br> <br>for( i = 0; i < num_ref_frames_in_pic_order_cnt_cycle; i++ )|||
|<br> <br> <br>**offset_for_ref_frame[** i**] **|0|se(v)|
|<br>}|||
|<br>**max_num_ref_frames**|0|ue(v)|
|<br>**gaps_in_frame_num_value_allowed_flag**|0|u(1)|
|<br>**pic_width_in_mbs_minus1**|0|ue(v)|
|<br>**pic_height_in_map_units_minus1**|0|ue(v)|
|<br>**frame_mbs_only_flag**|0|u(1)|
|<br>if( !frame_mbs_only_flag )|||
|<br> <br>**mb_adaptive_frame_field_flag**|0|u(1)|
|<br>**direct_8x8_inference_flag**|0|u(1)|
|<br>**frame_cropping_flag**|0|u(1)|
|<br>if( frame_cropping_flag ) {|||
|<br> <br>**frame_crop_left_offset**|0|ue(v)|
|<br> <br>**frame_crop_right_offset**|0|ue(v)|
|<br> <br>**frame_crop_top_offset**|0|ue(v)|
|<br> <br>**frame_crop_bottom_offset**|0|ue(v)|
|<br>}|||
|<br>**vui_parameters_present_flag**|0|u(1)|
|<br>if( vui_parameters_present_flag )|||
|<br> <br>vui_parameters( )|0||
|}|||


**7.3.2.1.1.1** **Scaling list syntax**

|scaling_list( scalingList, sizeOfScalingList, useDefaultScalingMatrixFlag ) {|C|Descriptor|
|---|---|---|
|<br>lastScale = 8|||
|<br>nextScale = 8|||
|<br>for( j = 0; j < sizeOfScalingList; j++ ) {|||
|<br> <br>if( nextScale != 0 ) {|||
|<br> <br> <br>**delta_scale**|0 | 1|se(v)|
|<br> <br> <br>nextScale = ( lastScale + delta_scale + 256 ) % 256|||
|<br> <br> <br>useDefaultScalingMatrixFlag = ( j = = 0 && nextScale = = 0 )|||
|<br> <br>}|||
|<br> <br>scalingList[ j ] = ( nextScale = = 0 ) ? lastScale : nextScale|||
|<br> <br>lastScale = scalingList[ j ]|||
|<br>}|||
|}|||






**7.3.2.1.2** **Sequence parameter set extension RBSP syntax**

|seq_parameter_set_extension_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>**seq_parameter_set_id** <br>|10|ue(v)|
|<br>**aux_format_idc**|10|ue(v)|
|<br>if( aux_format_idc != 0 ) {|||
|<br> <br>**bit_depth_aux_minus8**|10|ue(v)|
|<br> <br>**alpha_incr_flag**|10|u(1)|
|<br> <br>**alpha_opaque_value**|10|u(v)|
|<br> <br>**alpha_transparent_value**|10|u(v)|
|<br>}|||
|<br>**additional_extension_flag**|10|u(1)|
|<br>rbsp_trailing_bits( )|10||
|}|||



**7.3.2.1.3** **Subset sequence parameter set RBSP syntax**

|subset_seq_parameter_set_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>seq_parameter_set_data( )|0||
|<br>if( profile_idc = = 83 | | profile_idc = = 86 ) {|||
|<br> <br>seq_parameter_set_svc_extension( ) /* specified in Annex G */|0||
|<br> <br>**svc_vui_parameters_present_flag**|0|u(1)|
|<br> <br>if( svc_vui_parameters_present_flag = = 1 )|||
|<br> <br> <br>svc_vui_parameters_extension( ) /* specified in Annex G */|0||
|<br>} else if( profile_idc = = 118 | | profile_idc = = 128 | |<br> <br> <br>profile_idc = = 134 ) {|||
|<br> <br>**bit_equal_to_one** /* equal to 1 */|0|f(1)|
|<br> <br>seq_parameter_set_mvc_extension( ) /* specified in Annex H */|0||
|<br> <br>**mvc_vui_parameters_present_flag**|0|u(1)|
|<br> <br>if( mvc_vui_parameters_present_flag = = 1 )|||
|<br> <br> <br>mvc_vui_parameters_extension( ) /* specified in Annex H */|0||
|<br>} else if( profile_idc = = 138 | | profile_idc = = 135 ) {|||
|<br> <br>**bit_equal_to_one** /* equal to 1 */|0|f(1)|
|<br> <br>seq_parameter_set_mvcd_extension( ) /* specified in Annex I */|||
|<br>} else if( profile_idc = = 139 ) {|||
|<br> <br>**bit_equal_to_one** /* equal to 1 */|0|f(1)|
|<br> <br>seq_parameter_set_mvcd_extension( ) /* specified in Annex I */|0||
|<br> <br>seq_parameter_set_3davc_extension( ) /* specified in Annex J */|0||
|<br>}|||
|<br>**additional_extension2_flag**|0|u(1)|
|<br>if( additional_extension2_flag = = 1 )|||
|<br> <br>while( more_rbsp_data( ) )|||
|<br> <br> <br>**additional_extension2_data_flag**|0|u(1)|
|<br>rbsp_trailing_bits( )|0||
|}|||






**7.3.2.2** **Picture parameter set RBSP syntax**

|pic_parameter_set_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>**pic_parameter_set_id** <br>|1|ue(v)|
|<br>**seq_parameter_set_id** <br>|1|ue(v)|
|<br>**entropy_coding_mode_flag**|1|u(1)|
|<br>**bottom_field_pic_order_in_frame_present_flag**|1|u(1)|
|<br>**num_slice_groups_minus1**|1|ue(v)|
|<br>if( num_slice_groups_minus1 > 0 ) {|||
|<br> <br>**slice_group_map_type**|1|ue(v)|
|<br> <br>if( slice_group_map_type = = 0 )|||
|<br> <br> <br>for( iGroup = 0; iGroup <= num_slice_groups_minus1; iGroup++ )|||
|<br> <br> <br> <br>**run_length_minus1[** iGroup**]**|1|ue(v)|
|<br> <br>else if( slice_group_map_type = = 2 )|||
|<br> <br> <br>for( iGroup = 0; iGroup < num_slice_groups_minus1; iGroup++ ) {|||
|<br> <br> <br> <br>**top_left[** iGroup**]**|1|ue(v)|
|<br> <br> <br> <br>**bottom_right[** iGroup**]**|1|ue(v)|
|<br> <br> <br>}|||
|<br> <br>else if( slice_group_map_type = = 3 | |<br> <br> <br> <br> <br> <br>slice_group_map_type = = 4 | |<br> <br> <br> <br> <br> <br>slice_group_map_type = = 5 ) {|||
|<br> <br> <br>**slice_group_change_direction_flag**|1|u(1)|
|<br> <br> <br>**slice_group_change_rate_minus1**|1|ue(v)|
|<br> <br>} else if( slice_group_map_type = = 6 ) {|||
|<br> <br> <br>**pic_size_in_map_units_minus1**|1|ue(v)|
|<br> <br> <br>for( i = 0; i <= pic_size_in_map_units_minus1; i++ )|||
|<br> <br> <br> <br>**slice_group_id[** i**]**|1|u(v)|
|<br> <br>}|||
|<br>}|||
|<br>**num_ref_idx_l0_default_active_minus1**|1|ue(v)|
|<br>**num_ref_idx_l1_default_active_minus1**|1|ue(v)|
|<br>**weighted_pred_flag**|1|u(1)|
|<br>**weighted_bipred_idc**|1|u(2)|
|<br>**pic_init_qp_minus26**|1|se(v)|
|<br>**pic_init_qs_minus26**|1|se(v)|
|<br>**chroma_qp_index_offset**|1|se(v)|
|<br>**deblocking_filter_control_present_flag**|1|u(1)|
|<br>**constrained_intra_pred_flag**|1|u(1)|
|<br>**redundant_pic_cnt_present_flag**|1|u(1)|
|<br>if( more_rbsp_data( ) ) {|||
|<br> <br>**transform_8x8_mode_flag**|1|u(1)|
|<br> <br>**pic_scaling_matrix_present_flag**|1|u(1)|
|<br> <br>if( pic_scaling_matrix_present_flag )|||
|<br> <br> <br>for( i = 0; i < 6 +<br> <br> <br> <br> <br> <br>( ( chroma_format_idc != 3 ) ? 2 : 6 ) * transform_8x8_mode_flag;<br> <br> <br> <br> <br> <br>i++ ) {|||
|<br> <br> <br> <br>**pic_scaling_list_present_flag[** i**] **|1|u(1)|
|<br> <br> <br> <br>if( pic_scaling_list_present_flag[ i ] )|||
|<br> <br> <br> <br> <br>if( i < 6 )|||






|scaling_list( ScalingList4x4[ i ], 16,<br>UseDefaultScalingMatrix4x4Flag[ i ] )|1|Col3|
|---|---|---|
|<br> <br> <br> <br> <br>else|||
|<br> <br> <br> <br> <br> <br>scaling_list( ScalingList8x8[ i − 6 ], 64,<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>  UseDefaultScalingMatrix8x8Flag[ i − 6 ] )|1||
|<br> <br> <br>}|||
|<br> <br>**second_chroma_qp_index_offset**|1|se(v)|
|<br>}|||
|<br>rbsp_trailing_bits( )|1||
|}|||


**7.3.2.3** **Supplemental enhancement information RBSP syntax**

|sei_rbsp( ) {|C|Descriptor|
|---|---|---|
|do|||
|sei_message( )|5||
|while( more_rbsp_data( ) )|||
|rbsp_trailing_bits( )|5||
|}|||



**7.3.2.3.1** **Supplemental enhancement information message syntax**

|sei_message( ) {|C|Descriptor|
|---|---|---|
|payloadType = 0|||
|while( next_bits( 8 ) = = 0xFF ) {|||
|**ff_byte** /* equal to 0xFF */|5|f(8)|
|payloadType += 255|||
|}|||
|**last_payload_type_byte**|5|u(8)|
|payloadType += last_payload_type_byte|||
|payloadSize = 0|||
|while( next_bits( 8 ) = = 0xFF ) {|||
|**ff_byte**/* equal to 0xFF */|5|f(8)|
|payloadSize += 255|||
|}|||
|**last_payload_size_byte**|5|u(8)|
|payloadSize += last_payload_size_byte|||
|sei_payload( payloadType, payloadSize )|5||
|}|||



**7.3.2.4** **Access unit delimiter RBSP syntax**

|access_unit_delimiter_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>**primary_pic_type**|6|u(3)|
|<br>rbsp_trailing_bits( )|6||
|}|||






**7.3.2.5** **End of sequence RBSP syntax**

|end_of_seq_rbsp( ) {|C|Descriptor|
|---|---|---|
|}|||



**7.3.2.6** **End of stream RBSP syntax**

|end_of_stream_rbsp( ) {|C|Descriptor|
|---|---|---|
|}|||



**7.3.2.7** **Filler data RBSP syntax**

|filler_data_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>while( next_bits( 8 ) = = 0xFF ) <br>|||
|<br> <br>**ff_byte** /* equal to 0xFF */|9|f(8)|
|<br>rbsp_trailing_bits( )|9||
|}|||



**7.3.2.8** **Slice layer without partitioning RBSP syntax**

|slice_layer_without_partitioning_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>slice_header( )|2||
|<br>slice_data( ) /* all categories of slice_data( ) syntax */|2 | 3 | 4||
|<br>rbsp_slice_trailing_bits( )|2||
|}|||



**7.3.2.9** **Slice data partition RBSP syntax**


**7.3.2.9.1** **Slice data partition A RBSP syntax**

|slice_data_partition_a_layer_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>slice_header( )|2||
|<br>**slice_id**|All|ue(v)|
|<br>slice_data( ) /* only category 2 parts of slice_data( ) syntax */|2||
|<br>rbsp_slice_trailing_bits( )|2||
|}|||






**7.3.2.9.2** **Slice data partition B RBSP syntax**

|slice_data_partition_b_layer_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>**slice_id**|All|ue(v)|
|<br>if( separate_colour_plane_flag = = 1 )|||
|<br> <br>**colour_plane_id**|All|u(2)|
|<br>if( redundant_pic_cnt_present_flag )|||
|<br> <br>**redundant_pic_cnt**|All|ue(v)|
|<br>slice_data( ) /* only category 3 parts of slice_data( ) syntax */|3||
|<br>rbsp_slice_trailing_bits( )|3||
|}|||



**7.3.2.9.3** **Slice data partition C RBSP syntax**

|slice_data_partition_c_layer_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>**slice_id**|All|ue(v)|
|<br>if( separate_colour_plane_flag = = 1 )|||
|<br> <br>**colour_plane_id**|All|u(2)|
|<br>if( redundant_pic_cnt_present_flag )|||
|<br> <br>**redundant_pic_cnt**|All|ue(v)|
|<br>slice_data( ) /* only category 4 parts of slice_data( ) syntax */|4||
|<br>rbsp_slice_trailing_bits( )|4||
|}|||



**7.3.2.10** **RBSP slice trailing bits syntax**

|rbsp_slice_trailing_bits( ) {|C|Descriptor|
|---|---|---|
|<br>rbsp_trailing_bits( )|All||
|<br>if( entropy_coding_mode_flag )|||
|<br> <br>while( more_rbsp_trailing_data( ) )|||
|<br> <br> <br>**cabac_zero_word** /* equal to 0x0000 */|All|f(16)|
|}|||



**7.3.2.11** **RBSP trailing bits syntax**

|rbsp_trailing_bits( ) {|C|Descriptor|
|---|---|---|
|<br>**rbsp_stop_one_bit** /* equal to 1 */|All|f(1)|
|<br>while( !byte_aligned( ) )|||
|<br> <br>**rbsp_alignment_zero_bit** /* equal to 0 */|All|f(1)|
|}|||






**7.3.2.12** **Prefix NAL unit RBSP syntax**

|prefix_nal_unit_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>if( svc_extension_flag )|||
|<br> <br>prefix_nal_unit_svc( ) /* specified in Annex G */|2||
|}|||



**7.3.2.13** **Slice layer extension RBSP syntax**

|slice_layer_extension_rbsp( ) {|C|Descriptor|
|---|---|---|
|<br>if( svc_extension_flag ) {|||
|<br> <br>slice_header_in_scalable_extension( ) /* specified in Annex G */|2||
|<br> <br>if( !slice_skip_flag )|||
|<br> <br> <br>slice_data_in_scalable_extension( ) /* specified in Annex G */|2 | 3 | 4||
|<br>} else if( avc_3d_extension_flag ) {|||
|<br> <br>slice_header_in_3davc_extension( ) /* specified in Annex J */|2||
|<br> <br>slice_data_in_3davc_extension( ) /* specified in Annex J */|2 | 3 | 4||
|<br>} else {|||
|<br> <br>slice_header( )|2||
|<br> <br>slice_data( )|2 | 3 | 4||
|<br>}|||
|<br>rbsp_slice_trailing_bits( )|2||
|}|||



**7.3.3** **Slice header syntax**

|slice_header( ) {|C|Descriptor|
|---|---|---|
|<br>**first_mb_in_slice**|2|ue(v)|
|<br>**slice_type** <br>|2|ue(v)|
|<br>**pic_parameter_set_id**|2|ue(v)|
|<br>if( separate_colour_plane_flag = = 1 )|||
|<br> <br>**colour_plane_id**|2|u(2)|
|<br>**frame_num**|2|u(v)|
|<br>if( !frame_mbs_only_flag ) {<br>|||
|<br> <br>**field_pic_flag**|2|u(1)|
|<br> <br>if( field_pic_flag )|||
|<br> <br> <br>**bottom_field_flag**|2|u(1)|
|<br>}|||
|<br>if( IdrPicFlag )|||
|<br> <br>**idr_pic_id**|2|ue(v)|
|<br>if( pic_order_cnt_type = = 0 ) {|||
|<br> <br>**pic_order_cnt_lsb**|2|u(v)|
|<br> <br>if( bottom_field_pic_order_in_frame_present_flag && !field_pic_flag )|||
|<br> <br> <br>**delta_pic_order_cnt_bottom**|2|se(v)|
|<br>}|||
|<br>if( pic_order_cnt_type = = 1 && !delta_pic_order_always_zero_flag ) {|||
|<br> <br>**delta_pic_order_cnt[** 0**] **|2|se(v)|






|if( bottom_field_pic_order_in_frame_present_flag && !field_pic_flag )|Col2|Col3|
|---|---|---|
|<br> <br> <br>**delta_pic_order_cnt[** 1**] **|2|se(v)|
|<br>}|||
|<br>if( redundant_pic_cnt_present_flag )|||
|<br> <br>**redundant_pic_cnt**|2|ue(v)|
|<br>if( slice_type = = B )|||
|<br> <br>**direct_spatial_mv_pred_flag**|2|u(1)|
|<br>if( slice_type = = P | | slice_type = = SP | | slice_type = = B ) {|||
|<br> <br>**num_ref_idx_active_override_flag**|2|u(1)|
|<br> <br>if( num_ref_idx_active_override_flag ) {|||
|<br> <br> <br>**num_ref_idx_l0_active_minus1**|2|ue(v)|
|<br> <br> <br>if( slice_type = = B )|||
|<br> <br> <br> <br>**num_ref_idx_l1_active_minus1**|2|ue(v)|
|<br> <br>}|||
|<br>}|||
|<br>if( nal_unit_type = = 20 | | nal_unit_type = = 21 )|||
|<br> <br>ref_pic_list_mvc_modification( ) /* specified in Annex H */|2||
|<br>else|||
|<br> <br>ref_pic_list_modification( )|2||
|<br>if( ( weighted_pred_flag && ( slice_type = = P | | slice_type = = SP ) ) | |<br> <br> <br>( weighted_bipred_idc = = 1 && slice_type = = B ) )|||
|<br> <br>pred_weight_table( )|2||
|<br>if( nal_ref_idc != 0 )|||
|<br> <br>dec_ref_pic_marking( )|2||
|<br>if( entropy_coding_mode_flag && slice_type != I && slice_type != SI )|||
|<br> <br>**cabac_init_idc**|2|ue(v)|
|<br>**slice_qp_delta**|2|se(v)|
|<br>if( slice_type = = SP | | slice_type = = SI ) {|||
|<br> <br>if( slice_type = = SP )|||
|<br> <br> <br>**sp_for_switch_flag**|2|u(1)|
|<br> <br>**slice_qs_delta**|2|se(v)|
|<br>}|||
|<br>if( deblocking_filter_control_present_flag ) {|||
|<br> <br>**disable_deblocking_filter_idc**|2|ue(v)|
|<br> <br>if( disable_deblocking_filter_idc != 1 ) {|||
|<br> <br> <br>**slice_alpha_c0_offset_div2**|2|se(v)|
|<br> <br> <br>**slice_beta_offset_div2**|2|se(v)|
|<br> <br>}|||
|<br>}|||
|<br>if( num_slice_groups_minus1 > 0 &&<br> <br> <br>slice_group_map_type >= 3 && slice_group_map_type <= 5)|||
|<br> <br>**slice_group_change_cycle**|2|u(v)|
|}|||





**7.3.3.1** **Reference picture list modification syntax**

|ref_pic_list_modification( ) {|C|Descriptor|
|---|---|---|
|<br>if( slice_type % 5 != 2 && slice_type % 5 != 4 ) {|||
|<br> <br>**ref_pic_list_modification_flag_l0**|2|u(1)|
|<br> <br>if( ref_pic_list_modification_flag_l0 )|||
|<br> <br> <br>do {|||
|<br> <br> <br> <br>**modification_of_pic_nums_idc**|2|ue(v)|
|<br> <br> <br> <br>if( modification_of_pic_nums_idc = = 0 | |<br> <br> <br> <br> <br> <br>modification_of_pic_nums_idc = = 1 )|||
|<br> <br> <br> <br> <br>**abs_diff_pic_num_minus1**|2|ue(v)|
|<br> <br> <br> <br>else if( modification_of_pic_nums_idc = = 2 )|||
|<br> <br> <br> <br> <br>**long_term_pic_num**|2|ue(v)|
|<br> <br> <br>} while( modification_of_pic_nums_idc != 3 )|||
|<br>}|||
|<br>if( slice_type % 5 = = 1 ) {|||
|<br> <br>**ref_pic_list_modification_flag_l1**|2|u(1)|
|<br> <br>if( ref_pic_list_modification_flag_l1 )|||
|<br> <br> <br>do {|||
|<br> <br> <br> <br>**modification_of_pic_nums_idc**|2|ue(v)|
|<br> <br> <br> <br>if( modification_of_pic_nums_idc = = 0 | |<br> <br> <br> <br> <br> <br>modification_of_pic_nums_idc = = 1 )|||
|<br> <br> <br> <br> <br>**abs_diff_pic_num_minus1**|2|ue(v)|
|<br> <br> <br> <br>else if( modification_of_pic_nums_idc = = 2 )|||
|<br> <br> <br> <br> <br>**long_term_pic_num**|2|ue(v)|
|<br> <br> <br>} while( modification_of_pic_nums_idc != 3 )|||
|<br>}|||
|}|||






**7.3.3.2** **Prediction weight table syntax**

|pred_weight_table( ) {|C|Descriptor|
|---|---|---|
|<br>**luma_log2_weight_denom**|2|ue(v)|
|<br>if( ChromaArrayType != 0 )<br>|||
|<br> <br>**chroma_log2_weight_denom** <br>|2|ue(v)|
|<br>for( i = 0; i <= num_ref_idx_l0_active_minus1; i++ ) { <br>|||
|<br> <br>**luma_weight_l0_flag** <br>|2|u(1)|
|<br> <br>if( luma_weight_l0_flag ) { <br>|||
|<br> <br> <br>**luma_weight_l0[** i**]** <br>|2|se(v)|
|<br> <br> <br>**luma_offset_l0[** i**]** <br>|2|se(v)|
|<br> <br>}|||
|<br> <br>if( ChromaArrayType != 0 ) {<br>|||
|<br> <br> <br>**chroma_weight_l0_flag** <br>|2|u(1)|
|<br> <br> <br>if( chroma_weight_l0_flag ) <br>|||
|<br> <br> <br> <br>for( j =0; j < 2; j++ ) { <br>|||
|<br> <br> <br> <br> <br>**chroma_weight_l0[** i**][** j**]** <br>|2|se(v)|
|<br> <br> <br> <br> <br>**chroma_offset_l0[** i**][** j**]**|2|se(v)|
|<br> <br> <br> <br>}|||
|<br> <br>}|||
|<br>}|||
|<br>if( slice_type % 5 = = 1 )|||
|<br> <br>for( i = 0; i <= num_ref_idx_l1_active_minus1; i++ ) {|||
|<br> <br> <br>**luma_weight_l1_flag**|2|u(1)|
|<br> <br> <br>if( luma_weight_l1_flag ) {|||
|<br> <br> <br> <br>**luma_weight_l1[** i**]**|2|se(v)|
|<br> <br> <br> <br>**luma_offset_l1[** i**]**|2|se(v)|
|<br> <br> <br>}|||
|<br> <br> <br>if( ChromaArrayType != 0 ) {|||
|<br> <br> <br> <br>**chroma_weight_l1_flag**|2|u(1)|
|<br> <br> <br> <br>if( chroma_weight_l1_flag )|||
|<br> <br> <br> <br> <br>for( j = 0; j < 2; j++ ) {|||
|<br> <br> <br> <br> <br> <br>**chroma_weight_l1[** i**][** j**]**|2|se(v)|
|<br> <br> <br> <br> <br> <br>**chroma_offset_l1[** i**][** j**]**|2|se(v)|
|<br> <br> <br> <br> <br>}|||
|<br> <br> <br>}|||
|<br> <br>}|||
|}|||






**7.3.3.3** **Decoded reference picture marking syntax**

|dec_ref_pic_marking( ) {|C|Descriptor|
|---|---|---|
|<br>if( IdrPicFlag ) {|||
|<br> <br>**no_output_of_prior_pics_flag**|2 | 5|u(1)|
|<br> <br>**long_term_reference_flag**|2 | 5|u(1)|
|<br>} else {|||
|<br> <br>**adaptive_ref_pic_marking_mode_flag**|2 | 5|u(1)|
|<br> <br>if( adaptive_ref_pic_marking_mode_flag )|||
|<br> <br> <br>do {|||
|<br> <br> <br> <br>**memory_management_control_operation**|2 | 5|ue(v)|
|<br> <br> <br> <br>if( memory_management_control_operation = = 1 | |<br> <br> <br> <br> <br> <br>memory_management_control_operation = = 3 )|||
|<br> <br> <br> <br> <br>**difference_of_pic_nums_minus1**|2 | 5|ue(v)|
|<br> <br> <br> <br>if(memory_management_control_operation = = 2 )|||
|<br> <br> <br> <br> <br>**long_term_pic_num**|2 | 5|ue(v)|
|<br> <br> <br> if( memory_management_control_operation = = 3 | |<br> <br> <br> <br> <br> <br>memory_management_control_operation = = 6 )|||
|<br> <br> <br> <br> <br>**long_term_frame_idx**|2 | 5|ue(v)|
|<br> <br> <br> <br>if( memory_management_control_operation = = 4 )|||
|<br> <br> <br> <br> <br>**max_long_term_frame_idx_plus1**|2 | 5|ue(v)|
|<br> <br> <br>} while( memory_management_control_operation != 0 )|||
|<br>}|||
|}|||






**7.3.4** **Slice data syntax**

|slice_data( ) {|C|Descriptor|
|---|---|---|
|<br>if( entropy_coding_mode_flag )|||
|<br> <br>while( !byte_aligned( ) )|||
|<br> <br> <br>**cabac_alignment_one_bit**|2|f(1)|
|<br>CurrMbAddr = first_mb_in_slice * ( 1 + MbaffFrameFlag )|||
|<br>moreDataFlag = 1|||
|<br>prevMbSkipped = 0<br>|||
|<br>do {|||
|<br> <br>if( slice_type != I && slice_type != SI )|||
|<br> <br> <br>if( !entropy_coding_mode_flag ) {|||
|<br> <br> <br> <br>**mb_skip_run**|2|ue(v)|
|<br> <br> <br> <br>prevMbSkipped = ( mb_skip_run > 0 )|||
|<br> <br> <br> <br>for( i=0; i<mb_skip_run; i++ )|||
|<br> <br> <br> <br> <br>CurrMbAddr = NextMbAddress( CurrMbAddr )|||
|<br> <br> <br> <br>if( mb_skip_run > 0 )|||
|<br> <br> <br> <br> <br>moreDataFlag = more_rbsp_data( )|||
|<br> <br> <br>} else {|||
|<br> <br> <br> <br>**mb_skip_flag**|2|ae(v)|
|<br> <br> <br> <br>moreDataFlag = !mb_skip_flag|||
|<br> <br> <br>}|||
|<br> <br>if( moreDataFlag ) {|||
|<br> <br> <br>if( MbaffFrameFlag && ( CurrMbAddr % 2 = = 0 | |<br> <br> <br> <br> <br>( CurrMbAddr % 2 = = 1 && prevMbSkipped ) ) )|||
|<br> <br> <br> <br>**mb_field_decoding_flag**|2|u(1) | ae(v)|
|<br> <br> <br>macroblock_layer( )|2 | 3 | 4||
|<br> <br>}|||
|<br> <br>if( !entropy_coding_mode_flag )|||
|<br> <br> <br>moreDataFlag = more_rbsp_data( )|||
|<br> <br>else {|||
|<br> <br> <br>if( slice_type != I && slice_type != SI )|||
|<br> <br> <br> <br>prevMbSkipped = mb_skip_flag|||
|<br> <br> <br>if( MbaffFrameFlag && CurrMbAddr % 2 = = 0 )|||
|<br> <br> <br> <br>moreDataFlag = 1|||
|<br> <br> <br>else {|||
|<br> <br> <br> <br>**end_of_slice_flag**|2|ae(v)|
|<br> <br> <br> <br>moreDataFlag = !end_of_slice_flag|||
|<br> <br> <br>}|||
|<br> <br>}|||
|<br> <br>CurrMbAddr = NextMbAddress( CurrMbAddr )|||
|<br>} while( moreDataFlag )|||
|}|||






**7.3.5** **Macroblock layer syntax**

|macroblock_layer( ) {|C|Descriptor|
|---|---|---|
|<br>**mb_type**|2|ue(v) | ae(v)|
|<br>if( mb_type = = I_PCM ) {|||
|<br> <br>while( !byte_aligned( ) )|||
|<br> <br> <br>**pcm_alignment_zero_bit**|3|f(1)|
|<br> <br>for( i = 0; i < 256; i++ )|||
|<br> <br> <br>**pcm_sample_luma[** i**]**|3|u(v)|
|<br> <br>for( i = 0; i < 2 * MbWidthC * MbHeightC; i++ )|||
|<br> <br> <br>**pcm_sample_chroma[** i**]**|3|u(v)|
|<br>} else {|||
|<br> <br>noSubMbPartSizeLessThan8x8Flag = 1|||
|<br> <br>if( mb_type != I_NxN &&<br> <br> <br> <br>MbPartPredMode( mb_type, 0 ) != Intra_16x16 &&<br> <br> <br> <br>NumMbPart( mb_type ) = = 4 ) {|||
|<br> <br> <br>sub_mb_pred( mb_type )|2||
|<br> <br> <br>for( mbPartIdx = 0; mbPartIdx < 4; mbPartIdx++ )|||
|<br> <br> <br> <br>if( sub_mb_type[ mbPartIdx ] != B_Direct_8x8 ) {|||
|<br> <br> <br> <br> <br>if( NumSubMbPart( sub_mb_type[ mbPartIdx ] ) > 1 )|||
|<br> <br> <br> <br> <br> <br>noSubMbPartSizeLessThan8x8Flag = 0|||
|<br> <br> <br> <br>} else if( !direct_8x8_inference_flag )|||
|<br> <br> <br> <br> <br>noSubMbPartSizeLessThan8x8Flag = 0|||
|<br> <br>} else {|||
|<br> <br> <br>if( transform_8x8_mode_flag && mb_type = = I_NxN )|||
|<br> <br> <br> <br>**transform_size_8x8_flag**|2|u(1) | ae(v)|
|<br> <br> <br>mb_pred( mb_type )|2||
|<br> <br>}|||
|<br> <br>if( MbPartPredMode( mb_type, 0 ) != Intra_16x16 ) {|||
|<br> <br> <br>**coded_block_pattern**|2|me(v) | ae(v)|
|<br> <br> <br>if( CodedBlockPatternLuma > 0 &&<br> <br> <br> <br> <br> transform_8x8_mode_flag && mb_type != I_NxN &&<br> <br> <br> <br> <br> noSubMbPartSizeLessThan8x8Flag &&<br> <br> <br> <br> <br> ( mb_type != B_Direct_16x16 | | direct_8x8_inference_flag ) )|||
|<br> <br> <br> <br>**transform_size_8x8_flag**|2|u(1) | ae(v)|
|<br> <br>}|||
|<br> <br>if( CodedBlockPatternLuma > 0 | | CodedBlockPatternChroma > 0 | |<br> <br> <br> <br>MbPartPredMode( mb_type, 0 ) = = Intra_16x16 ) {|||
|<br> <br> <br>**mb_qp_delta**|2|se(v) | ae(v)|
|<br> <br> <br>residual( 0, 15 )|3 | 4||
|<br> <br>}|||
|<br>}|||
|}|||






**7.3.5.1** **Macroblock prediction syntax**

|mb_pred( mb_type ) {|C|Descriptor|
|---|---|---|
|<br>if( MbPartPredMode( mb_type, 0 ) = = Intra_4x4 | |<br> <br> <br>MbPartPredMode( mb_type, 0 ) = = Intra_8x8 | |<br> <br> <br>MbPartPredMode( mb_type, 0 ) = = Intra_16x16 ) {|||
|<br> <br>if( MbPartPredMode( mb_type, 0 ) = = Intra_4x4 )|||
|<br> <br> <br>for( luma4x4BlkIdx=0; luma4x4BlkIdx<16; luma4x4BlkIdx++ ) {|||
|<br> <br> <br> <br>**prev_intra4x4_pred_mode_flag[** luma4x4BlkIdx**]**|2|u(1) | ae(v)|
|<br> <br> <br> <br>if( !prev_intra4x4_pred_mode_flag**[** luma4x4BlkIdx**]** )|||
|<br> <br> <br> <br> <br>**rem_intra4x4_pred_mode[** luma4x4BlkIdx**]**|2|u(3) | ae(v)|
|<br> <br> <br>}|||
|<br> <br>if( MbPartPredMode( mb_type, 0 ) = = Intra_8x8 )|||
|<br> <br> <br>for( luma8x8BlkIdx=0; luma8x8BlkIdx<4; luma8x8BlkIdx++ ) {|||
|<br> <br> <br> <br>**prev_intra8x8_pred_mode_flag[** luma8x8BlkIdx**]**|2|u(1) | ae(v)|
|<br> <br> <br> <br>if( !prev_intra8x8_pred_mode_flag[ luma8x8BlkIdx ] )|||
|<br> <br> <br> <br> <br>**rem_intra8x8_pred_mode[** luma8x8BlkIdx**]**|2|u(3) | ae(v)|
|<br> <br> <br>}|||
|<br> <br>if( ChromaArrayType = = 1 | | ChromaArrayType = = 2 )|||
|<br> <br> <br>**intra_chroma_pred_mode**|2|ue(v) | ae(v)|
|<br>} else if( MbPartPredMode( mb_type, 0 ) != Direct ) {|||
|<br> <br>for( mbPartIdx = 0; mbPartIdx < NumMbPart( mb_type ); mbPartIdx++ )|||
|<br> <br> <br>if( ( num_ref_idx_l0_active_minus1 > 0 | |<br> <br> <br> <br> <br> <br>mb_field_decoding_flag != field_pic_flag ) &&<br> <br> <br> <br> <br>MbPartPredMode( mb_type, mbPartIdx ) != Pred_L1 )|||
|<br> <br> <br> <br>**ref_idx_l0[** mbPartIdx**]**|2|te(v) | ae(v)|
|<br> <br>for( mbPartIdx = 0; mbPartIdx < NumMbPart( mb_type ); mbPartIdx++ )|||
|<br> <br> <br>if( ( num_ref_idx_l1_active_minus1 > 0 | |<br> <br> <br> <br> <br> <br>mb_field_decoding_flag != field_pic_flag ) &&<br> <br> <br> <br> <br>MbPartPredMode( mb_type, mbPartIdx ) != Pred_L0 )|||
|<br> <br> <br> <br>**ref_idx_l1[** mbPartIdx**]**|2|te(v) | ae(v)|
|<br> <br>for( mbPartIdx = 0; mbPartIdx < NumMbPart( mb_type ); mbPartIdx++ )|||
|<br> <br> <br>if( MbPartPredMode ( mb_type, mbPartIdx ) != Pred_L1 )|||
|<br> <br> <br> <br>for( compIdx = 0; compIdx < 2; compIdx++ )|||
|<br> <br> <br> <br> <br>**mvd_l0[** mbPartIdx**][** 0**][** compIdx**]**|2|se(v) | ae(v)|
|<br> <br>for( mbPartIdx = 0; mbPartIdx < NumMbPart( mb_type ); mbPartIdx++ )|||
|<br> <br> <br>if( MbPartPredMode( mb_type, mbPartIdx ) != Pred_L0 )|||
|<br> <br> <br> <br>for( compIdx = 0; compIdx < 2; compIdx++ )|||
|<br> <br> <br> <br> <br>**mvd_l1[** mbPartIdx**][** 0**][** compIdx**]**|2|se(v) | ae(v)|
|<br>}|||
|}|||






**7.3.5.2** **Sub-macroblock prediction syntax**

|sub_mb_pred( mb_type ) {|C|Descriptor|
|---|---|---|
|<br>for( mbPartIdx = 0; mbPartIdx < 4; mbPartIdx++ )|||
|<br> <br>**sub_mb_type[** mbPartIdx**]**|2|ue(v) | ae(v)|
|<br>for( mbPartIdx = 0; mbPartIdx < 4; mbPartIdx++ )|||
|<br> <br>if( ( num_ref_idx_l0_active_minus1 > 0 | |<br> <br> <br> <br> <br>mb_field_decoding_flag != field_pic_flag ) &&<br> <br> <br> <br>mb_type != P_8x8ref0 &&<br> <br> <br> <br>sub_mb_type[ mbPartIdx ] != B_Direct_8x8 &&<br> <br> <br> <br>SubMbPredMode( sub_mb_type[ mbPartIdx ] ) != Pred_L1 )|||
|<br> <br> <br>**ref_idx_l0[** mbPartIdx**]**|2|te(v) | ae(v)|
|<br>for( mbPartIdx = 0; mbPartIdx < 4; mbPartIdx++ )|||
|<br> <br>if( ( num_ref_idx_l1_active_minus1 > 0 | |<br> <br> <br> <br> <br>mb_field_decoding_flag != field_pic_flag ) &&<br> <br> <br> <br> sub_mb_type[ mbPartIdx ] != B_Direct_8x8 &&<br> <br> <br> <br> SubMbPredMode( sub_mb_type[ mbPartIdx ] ) != Pred_L0 )|||
|<br> <br> <br>**ref_idx_l1[** mbPartIdx**]**|2|te(v) | ae(v)|
|<br>for( mbPartIdx = 0; mbPartIdx < 4; mbPartIdx++ )|||
|<br> <br>if( sub_mb_type[ mbPartIdx ] != B_Direct_8x8 &&<br> <br> <br> <br>SubMbPredMode( sub_mb_type[ mbPartIdx ] ) != Pred_L1 )|||
|<br> <br> <br>for( subMbPartIdx = 0;<br> <br> <br> <br> <br>  subMbPartIdx < NumSubMbPart( sub_mb_type[ mbPartIdx ] );<br> <br> <br> <br> <br>  subMbPartIdx++ )|||
|<br> <br> <br> <br>for( compIdx = 0; compIdx < 2; compIdx++ )|||
|<br> <br> <br> <br> <br>**mvd_l0[** mbPartIdx**][** subMbPartIdx**][** compIdx**]**|2|se(v) | ae(v)|
|<br>for( mbPartIdx = 0; mbPartIdx < 4; mbPartIdx++ )|||
|<br> <br>if( sub_mb_type[ mbPartIdx ] != B_Direct_8x8 &&<br> <br> <br> <br>SubMbPredMode( sub_mb_type[ mbPartIdx ] ) != Pred_L0 )|||
|<br> <br> <br>for( subMbPartIdx = 0;<br> <br> <br> <br> <br>  subMbPartIdx < NumSubMbPart( sub_mb_type[ mbPartIdx ] );<br> <br> <br> <br> <br>  subMbPartIdx++ )|||
|<br> <br> <br> <br>for( compIdx = 0; compIdx < 2; compIdx++ )|||
|<br> <br> <br> <br> <br>**mvd_l1[** mbPartIdx**][** subMbPartIdx**][** compIdx**]**|2|se(v) | ae(v)|
|}|||






**7.3.5.3** **Residual data syntax**



|residual( startIdx, endIdx ) {|C|Descriptor|
|---|---|---|
|<br>if( !entropy_coding_mode_flag )|||
|<br> <br>residual_block = residual_block_cavlc|||
|<br>else|||
|<br> <br>residual_block = residual_block_cabac|||
|<br>residual_luma( i16x16DClevel, i16x16AClevel, level4x4, level8x8,<br> <br>             startIdx, endIdx )|3 | 4||
|<br>Intra16x16DCLevel = i16x16DClevel|||
|<br>Intra16x16ACLevel = i16x16AClevel|||
|<br>LumaLevel4x4 = level4x4|||
|<br>LumaLevel8x8 = level8x8|||
|<br>if( ChromaArrayType = = 1 | | ChromaArrayType = = 2 ) {|||
|<br> <br>NumC8x8 = 4 / ( SubWidthC * SubHeightC )|||
|<br> <br>for( iCbCr = 0; iCbCr < 2; iCbCr++ )|||
|<br> <br> <br>if( ( CodedBlockPatternChroma & 3 ) && startIdx = = 0 )<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>/* chroma DC residual present */|||
|<br> <br> <br> <br>residual_block( ChromaDCLevel[ iCbCr ], 0, 4 * NumC8x8 − 1,<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>4 * NumC8x8 )|3 | 4||
|<br> <br> <br>else|||
|<br> <br> <br> <br>for( i = 0; i < 4 * NumC8x8; i++ )|||
|<br> <br> <br> <br> <br>ChromaDCLevel[ iCbCr ][ i ] = 0|||
|<br> <br>for( iCbCr = 0; iCbCr < 2; iCbCr++ )|||
|<br> <br> <br>for( i8x8 = 0; i8x8 < NumC8x8; i8x8++ )|||
|<br> <br> <br> <br>for( i4x4 = 0; i4x4 < 4; i4x4++ )|||
|<br> <br> <br> <br> <br>if( CodedBlockPatternChroma & 2 )<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>/* chroma AC residual present */|||
|<br> <br> <br> <br> <br> <br>residual_block( ChromaACLevel[ iCbCr ][ i8x8 * 4+ i4x4 ],<br> <br> <br> <br> <br> <br> <br>             Max( 0, startIdx − 1 ), endIdx − 1, 15 )|3 | 4||
|<br> <br> <br> <br> <br>else|||
|<br> <br> <br> <br> <br> <br>for( i = 0; i < 15; i++ )|||
|<br> <br> <br> <br> <br> <br> <br>ChromaACLevel[ iCbCr ][ i8x8 * 4 + i4x4 ][ i ] = 0|||
|<br>} else if( ChromaArrayType = = 3 ) {|||
|<br> <br>residual_luma( i16x16DClevel, i16x16AClevel, level4x4, level8x8,<br> <br> <br>             startIdx, endIdx )|3 | 4||
|<br> <br>CbIntra16x16DCLevel = i16x16DClevel|||
|<br> <br>CbIntra16x16ACLevel = i16x16AClevel|||
|<br> <br>CbLevel4x4 = level4x4|||
|<br> <br>CbLevel8x8 = level8x8|||
|<br> <br>residual_luma( i16x16DClevel, i16x16AClevel, level4x4, level8x8,<br> <br> <br>             startIdx, endIdx )|3 | 4||
|<br> <br>CrIntra16x16DCLevel = i16x16DClevel|||
|<br> <br>CrIntra16x16ACLevel = i16x16AClevel|||
|<br> <br>CrLevel4x4 = level4x4|||
|<br> <br>CrLevel8x8 = level8x8|||
|<br>}|||







**7.3.5.3.1** **Residual luma syntax**












|residual_luma( i16x16DClevel, i16x16AClevel, level4x4, level8x8,<br>startIdx, endIdx ) {|C|Descriptor|
|---|---|---|
|<br>if( startIdx  = =  0  &&  MbPartPredMode( mb_type, 0 )  = =  Intra_16x16 )|||
|<br> <br>residual_block( i16x16DClevel, 0, 15, 16 )|3||
|<br>for( i8x8 = 0; i8x8 < 4; i8x8++ )|||
|<br> <br>if( !transform_size_8x8_flag  | |  !entropy_coding_mode_flag )|||
|<br> <br> <br>for( i4x4 = 0; i4x4 < 4; i4x4++ ) {|||
|<br> <br> <br> <br>if( CodedBlockPatternLuma & ( 1 << i8x8 ) )|||
|<br> <br> <br> <br> <br>if( MbPartPredMode( mb_type, 0 )  = =  Intra_16x16 )|||
|<br> <br> <br> <br> <br> <br>residual_block( i16x16AClevel[ i8x8 * 4 + i4x4 ],<br> <br> <br> <br> <br> <br> <br>                         Max( 0, startIdx − 1 ), endIdx − 1, 15 )<br>|3||
|<br> <br> <br> <br> <br>else|||
|<br> <br> <br> <br> <br> <br>residual_block( level4x4[ i8x8 * 4 + i4x4 ],<br> <br> <br> <br> <br> <br> <br>                         startIdx, endIdx, 16 ) <br>|3 | 4||
|<br> <br> <br> <br>else if( MbPartPredMode( mb_type, 0 )  = =  Intra_16x16 ) <br>|||
|<br> <br> <br> <br> <br>for( i = 0; i < 15; i++ ) <br>|||
|<br> <br> <br> <br> <br> <br>i16x16AClevel[ i8x8 * 4 + i4x4 ][ i ] = 0 <br>|||
|<br> <br> <br> <br>else <br>|||
|<br> <br> <br> <br> <br>for( i = 0; i < 16; i++ ) <br>|||
|<br> <br> <br> <br> <br> <br>level4x4[ i8x8 * 4 + i4x4 ][ i ] = 0 <br>|||
|<br> <br> <br> <br>if( !entropy_coding_mode_flag && transform_size_8x8_flag ) <br>|||
|<br> <br> <br> <br> <br>for( i = 0; i < 16; i++ ) <br>|||
|<br> <br> <br> <br> <br> <br>level8x8[ i8x8 ][ 4 * i + i4x4 ] = level4x4[ i8x8 * 4 + i4x4 ][ i ] <br>|||
|<br> <br> <br>} <br>|||
|<br> <br>else if( CodedBlockPatternLuma & ( 1 << i8x8 ) ) <br>|||
|<br> <br> <br>residual_block( level8x8[ i8x8 ], 4 * startIdx, 4 * endIdx + 3, 64 ) <br>|3 | 4||
|<br> <br>else|||
|<br> <br> <br>for( i = 0; i < 64; i++ )|||
|<br> <br> <br> <br>level8x8[ i8x8 ][ i ] = 0|||
|}|||



**7.3.5.3.2** **Residual block CAVLC syntax**

|residual_block_cavlc( coeffLevel, startIdx, endIdx, maxNumCoeff ) {|C|Descriptor|
|---|---|---|
|<br>for( i = 0; i < maxNumCoeff; i++ )|||
|<br> <br>coeffLevel[ i ] = 0|||
|<br>**coeff_token**|3 | 4|ce(v)|
|<br>if( TotalCoeff( coeff_token ) > 0 ) {|||
|<br> <br>if( TotalCoeff( coeff_token ) > 10 && TrailingOnes( coeff_token ) < 3 )|||
|<br> <br> <br>suffixLength = 1|||
|<br> <br>else|||
|<br> <br> <br>suffixLength = 0|||
|<br> <br>for( i = 0; i < TotalCoeff( coeff_token ); i++ )|||
|<br> <br> <br>if( i < TrailingOnes( coeff_token ) ) {|||
|<br> <br> <br> <br>**trailing_ones_sign_flag**|3 | 4|u(1)|
|<br> <br> <br> <br>levelVal[ i ] = 1 − 2 * trailing_ones_sign_flag|||
|<br> <br> <br>} else {|||






|level_prefix|3 | 4|ce(v)|
|---|---|---|
|<br> <br> <br> <br>levelCode = ( Min( 15, level_prefix ) << suffixLength )|||
|<br> <br> <br> <br>if( suffixLength > 0 | | level_prefix >= 14 ) {|||
|<br> <br> <br> <br> <br>**level_suffix**|3 | 4|u(v)|
|<br> <br> <br> <br> <br>levelCode += level_suffix|||
|<br> <br> <br> <br>}|||
|<br> <br> <br> <br>if( level_prefix > = 15 && suffixLength = = 0 )|||
|<br> <br> <br> <br> <br>levelCode += 15|||
|<br> <br> <br> <br>if( level_prefix > = 16 )|||
|<br> <br> <br> <br> <br>levelCode += ( 1 << ( level_prefix − 3 ) ) − 4096|||
|<br> <br> <br> <br>if( i = = TrailingOnes( coeff_token ) &&<br> <br> <br> <br> <br> <br> TrailingOnes( coeff_token ) < 3 )|||
|<br> <br> <br> <br> <br>levelCode += 2|||
|<br> <br> <br> <br>if( levelCode % 2 = = 0 )|||
|<br> <br> <br> <br> <br>levelVal[ i ] = ( levelCode + 2 ) >> 1|||
|<br> <br> <br> <br>else|||
|<br> <br> <br> <br> <br>levelVal[ i ] = ( −levelCode − 1 ) >> 1|||
|<br> <br> <br> <br>if( suffixLength = = 0 )|||
|<br> <br> <br> <br> <br>suffixLength = 1|||
|<br> <br> <br> <br>if( Abs( levelVal[ i ] ) > ( 3 << ( suffixLength − 1 ) ) &&<br> <br> <br> <br> <br> <br> suffixLength < 6 )|||
|<br> <br> <br> <br> <br>suffixLength++|||
|<br> <br> <br>}|||
|<br> <br>if( TotalCoeff( coeff_token ) < endIdx − startIdx + 1 ) {|||
|<br> <br> <br>**total_zeros**|3 | 4|ce(v)|
|<br> <br> <br>zerosLeft = total_zeros|||
|<br> <br>} else|||
|<br> <br> <br>zerosLeft = 0|||
|<br> <br>for( i = 0; i < TotalCoeff( coeff_token ) − 1; i++ ) {|||
|<br> <br> <br>if( zerosLeft > 0 ) {|||
|<br> <br> <br> <br>**run_before**|3 | 4|ce(v)|
|<br> <br> <br> <br>runVal[ i ] = run_before|||
|<br> <br> <br>} else|||
|<br> <br> <br> <br>runVal[ i ] = 0|||
|<br> <br> <br>zerosLeft = zerosLeft − runVal[ i ]|||
|<br> <br>}|||
|<br> <br>runVal[ TotalCoeff( coeff_token ) − 1 ] = zerosLeft|||
|<br> <br>coeffNum = −1|||
|<br> <br>for( i = TotalCoeff( coeff_token ) − 1; i >= 0; i− − ) {|||
|<br> <br> <br>coeffNum += runVal[ i ] + 1|||
|<br> <br> <br>coeffLevel[ startIdx + coeffNum ] = levelVal[ i ]|||
|<br> <br>}|||
|<br>}|||
|}|||





**7.3.5.3.3** **Residual block CABAC syntax**

|residual_block_cabac( coeffLevel, startIdx, endIdx, maxNumCoeff ) {|C|Descriptor|
|---|---|---|
|<br>if( maxNumCoeff != 64 | | ChromaArrayType = = 3 )|||
|<br> <br>**coded_block_flag**|3 | 4|ae(v)|
|<br>for( i = 0; i < maxNumCoeff; i++ )|||
|<br> <br>coeffLevel[ i ] = 0|||
|<br>if( coded_block_flag ) {|||
|<br> <br>numCoeff = endIdx + 1|||
|<br> <br>i = startIdx|||
|<br> <br>while( i < numCoeff − 1 ) {|||
|<br> <br> <br>**significant_coeff_flag[** i**]**|3 | 4|ae(v)|
|<br> <br> <br>if( significant_coeff_flag[ i ] ) {|||
|<br> <br> <br> <br>**last_significant_coeff_flag[** i**]**|3 | 4|ae(v)|
|<br> <br> <br> <br>if( last_significant_coeff_flag[ i ] )|||
|<br> <br> <br> <br> <br>numCoeff = i + 1|||
|<br> <br> <br>}|||
|<br> <br> <br>i++|||
|<br> <br>}|||
|<br> <br>**coeff_abs_level_minus1[** numCoeff − 1**]**|3 | 4|ae(v)|
|<br> <br>**coeff_sign_flag[** numCoeff − 1**] **|3 | 4|ae(v)|
|<br> <br>coeffLevel[ numCoeff − 1 ] =<br> <br> <br> <br>( coeff_abs_level_minus1[ numCoeff − 1 ] + 1 ) *<br> <br> <br> <br>( 1 − 2 * coeff_sign_flag[ numCoeff − 1 ] )|||
|<br> <br>for( i = numCoeff − 2; i >= startIdx; i− − )|||
|<br> <br> <br>if( significant_coeff_flag[ i ] ) {|||
|<br> <br> <br> <br>**coeff_abs_level_minus1[** i**]**|3 | 4|ae(v)|
|<br> <br> <br> <br>**coeff_sign_flag[** i**]**|3 | 4|ae(v)|
|<br> <br> <br> <br>coeffLevel[ i ] = ( coeff_abs_level_minus1[ i ] + 1 ) *<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> ( 1 − 2 * coeff_sign_flag[ i ] )|||
|<br> <br> <br>}|||
|<br>}|||
|}|||
