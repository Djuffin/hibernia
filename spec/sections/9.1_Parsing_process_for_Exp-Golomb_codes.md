**9.1** **Parsing process for Exp-Golomb codes**


This process is invoked when the descriptor of a syntax element in the syntax tables in clause 7.3 is equal to ue(v), me(v),
se(v), or te(v). For syntax elements in clauses 7.3.4 and 7.3.5, this process is invoked only when
entropy_coding_mode_flag is equal to 0.


Inputs to this process are bits from the RBSP.


Outputs of this process are syntax element values.


Syntax elements coded as ue(v), me(v), or se(v) are Exp-Golomb-coded. Syntax elements coded as te(v) are truncated ExpGolomb-coded. The parsing process for these syntax elements begins with reading the bits starting at the current location
in the bitstream up to and including the first non-zero bit, and counting the number of leading bits that are equal to 0. This
process is specified as follows:

leadingZeroBits = −1
for( b = 0; !b; leadingZeroBits++ ) (9-1)
b = read_bits( 1 )


The variable codeNum is then assigned as follows:

codeNum = 2 [leadingZeroBits]     - 1 + read_bits( leadingZeroBits ) (9-2)


where the value returned from read_bits( leadingZeroBits ) is interpreted as a binary representation of an unsigned integer
with most significant bit written first.


Table 9-1 illustrates the structure of the Exp-Golomb code by separating the bit string into "prefix" and "suffix" bits. The
"prefix" bits are those bits that are parsed in the above pseudo-code for the computation of leadingZeroBits, and are shown
as either 0 or 1 in the bit string column of Table 9-1. The "suffix" bits are those bits that are parsed in the computation of
codeNum and are shown as xi in Table 9-1, with i being in the range 0 to leadingZeroBits − 1, inclusive. Each xi can take
on values 0 or 1.





**Table 9-1 – Bit strings with "prefix" and "suffix" bits and assignment to codeNum ranges (informative)**

|Bit string form|Range of codeNum|
|---|---|
|`     1`|0|
|`    0 1 x0`|1..2|
|`   0 0 1 x1 x0`|3..6|
|`  0 0 0 1 x2 x1 x0`|7..14|
|` 0 0 0 0 1 x3 x2 x1 x0`|15..30|
|`0 0 0 0 0 1 x4 x3 x2 x1 x0 `|31..62|
|`… `|…|



Table 9-2 illustrates explicitly the assignment of bit strings to codeNum values.


**Table 9-2 – Exp-Golomb bit strings and codeNum in explicit form and used as ue(v) (informative)**

|Bit string|codeNum|
|---|---|
|`1 `|0|
|`0 1 0`|1|
|`0 1 1`|2|
|`0 0 1 0 0`|3|
|`0 0 1 0 1`|4|
|`0 0 1 1 0`|5|
|`0 0 1 1 1`|6|
|`0 0 0 1 0 0 0`|7|
|`0 0 0 1 0 0 1`|8|
|`0 0 0 1 0 1 0`|9|
|`… `|…|



Depending on the descriptor, the value of a syntax element is derived as follows:


- If the syntax element is coded as ue(v), the value of the syntax element is equal to codeNum.


- Otherwise, if the syntax element is coded as se(v), the value of the syntax element is derived by invoking the mapping
process for signed Exp-Golomb codes as specified in clause 9.1.1 with codeNum as the input.


- Otherwise, if the syntax element is coded as me(v), the value of the syntax element is derived by invoking the mapping
process for coded block pattern as specified in clause 9.1.2 with codeNum as the input.


- Otherwise (the syntax element is coded as te(v)), the range of possible values for the syntax element is determined
first. The range of this syntax element may be between 0 and x, with x being greater than or equal to 1 and the range
is used in the derivation of the value of the syntax element value as follows:


   - If x is greater than 1, codeNum and the value of the syntax element is derived in the same way as for syntax
elements coded as ue(v).


   - Otherwise (x is equal to 1), the parsing process for codeNum which is equal to the value of the syntax element
is given by a process equivalent to:

b = read_bits( 1 ) (9-3)
codeNum = !b





**9.1.1** **Mapping process for signed Exp-Golomb codes**


Input to this process is codeNum as specified in clause 9.1.


Output of this process is a value of a syntax element coded as se(v).


The syntax element is assigned to the codeNum by ordering the syntax element by its absolute value in increasing order
and representing the positive value for a given absolute value with the lower codeNum. Table 9-3 provides the assignment
rule.


**Table 9-3 – Assignment of syntax element to codeNum for signed Exp-Golomb coded syntax elements se(v)**

|codeNum|syntax element value|
|---|---|
|0|0|
|1|1|
|2|−1|
|3|2|
|4|−2|
|5|3|
|6|−3|
|k|(−1)k+1 Ceil( k÷2 )|



**9.1.2** **Mapping process for coded block pattern**


Input to this process is codeNum as specified in clause 9.1.


Output of this process is a value of the syntax element coded_block_pattern coded as me(v).


Table 9-4 shows the assignment of coded_block_pattern to codeNum depending on whether the macroblock prediction
mode is equal to Intra_4x4, Intra_8x8 or Inter.





**Table 9-4 – Assignment of codeNum to values of coded_block_pattern for macroblock prediction modes**


**(a) ChromaArrayType is equal to 1 or 2**

|codeNum|coded_block_pattern|Col3|
|---|---|---|
||**Intra_4x4, Intra_8x8**|**Inter**|
|0|47|0|
|1|31|16|
|2|15|1|
|3|0|2|
|4|23|4|
|5|27|8|
|6|29|32|
|7|30|3|
|8|7|5|
|9|11|10|
|10|13|12|
|11|14|15|
|12|39|47|
|13|43|7|
|14|45|11|
|15|46|13|
|16|16|14|
|17|3|6|
|18|5|9|
|19|10|31|
|20|12|35|
|21|19|37|
|22|21|42|
|23|26|44|
|24|28|33|
|25|35|34|
|26|37|36|
|27|42|40|
|28|44|39|
|29|1|43|
|30|2|45|






**(a) ChromaArrayType is equal to 1 or 2**

|codeNum|coded_block_pattern|Col3|
|---|---|---|
||**Intra_4x4, Intra_8x8**|**Inter**|
|31|4|46|
|32|8|17|
|33|17|18|
|34|18|20|
|35|20|24|
|36|24|19|
|37|6|21|
|38|9|26|
|39|22|28|
|40|25|23|
|41|32|27|
|42|33|29|
|43|34|30|
|44|36|22|
|45|40|25|
|46|38|38|
|47|41|41|



**(b) ChromaArrayType is equal to 0 or 3**

|codeNum|coded_block_pattern|Col3|
|---|---|---|
||**Intra_4x4, Intra_8x8**|**Inter**|
|0|15|0|
|1|0|1|
|2|7|2|
|3|11|4|
|4|13|8|
|5|14|3|
|6|3|5|
|7|5|10|
|8|10|12|
|9|12|15|






**(b) ChromaArrayType is equal to 0 or 3**

|codeNum|coded_block_pattern|Col3|
|---|---|---|
||**Intra_4x4, Intra_8x8**|**Inter**|
|10|1|7|
|11|2|11|
|12|4|13|
|13|8|14|
|14|6|6|
|15|9|9|
